/*
 * Copyright (c) 2021 Arm Limited and Contributors. All rights reserved.
 *
 * SPDX-License-Identifier: Apache-2.0
 * 
 * 
 * This examples captures data from an analog microphone using a sample
 * rate of 8 kHz and prints the sample values over the USB serial
 * connection.
 */
#include <stdio.h>
#include "edge-impulse-sdk/classifier/ei_run_classifier.h"
#include "pico/stdlib.h"
#include "analog_microphone.h"
#include "analog_microphone.c"
#include "tusb.h"

static const float features_[] = {
    // copy raw features here (for example from the 'Live classification' page)
    //tr
    47.0317, -72.1768, 117.9722, 17.8876, 167.3852, 172.4640, 258.5135, 180.4900, 133.5693, 141.4468, 258.1465, 113.7505, 102.1390, -221.9448, -98.4082, -242.9964, -150.7310, -48.7650, -60.0068, 115.0470, 132.3676, -124.1636, 155.4743, 212.0791, 212.9456, 119.2470, 172.8387, 94.6982, 213.2175, 87.8402, 54.1866, -102.2086, -234.4976, -7.5349, -93.3024, -17.5163, 173.0645, -14.5416, 90.9871, 285.7351, -57.6093, 139.4587, 42.3541, 151.7818, 251.1230, 30.5674, 175.0458, 112.5514, -125.7869, -235.2240, -61.5915, -1.7119, 33.4316, -46.3736, -15.4867, -86.0198, 11.7384, 234.8167, 168.2486, 96.1432, 228.9877, 235.2294, 204.0571, 262.1152, 128.6641, 86.9561, 6.1855, 73.0968, 148.4533, -60.5487, -36.5219, -94.0459, -157.0933, -175.3004, -33.1335, -26.1787, 158.9696, -69.2265, 7.2400, 228.2713, 200.9963, 239.7651, 174.9670, 269.5381, 150.1951, -35.5867, 23.1246, -282.1492, -37.9080, -189.3861, -1.1322, -13.1892, -49.6989, -222.7156, -34.1855, 91.9498, 37.1802, 225.2317, 242.7509, 198.9438, 307.0045, 183.1619, -37.3925, 37.0601, -33.7101, -222.6822, -108.4228, 28.3696, -196.8404, -41.4578, -107.5392, -50.5099, -121.9703, -192.7197, 139.6500, 80.1806, 279.3966, 281.8926, 143.6027, 180.1916, 184.4167, 119.9602, 134.6371, 117.9916, 156.2727, -66.7496, -124.7075, -138.6888, -133.2464, 26.5877, -39.3982, 121.0306, 59.9004, 63.0716, 255.8850, 213.3622, 308.3877, 170.6391, 131.8350, 42.9512, -77.1847, -111.6144, -177.9920, 42.2316, -42.4258, -6.3762, 12.4591, 67.9398, -42.6477, 9.7507, -64.9608, -169.3508, 83.5242, 323.1155, 339.9348, 331.7519, 316.3974, 72.9922, 56.0754, 58.2401, -15.8085, 22.5750, -157.3461, -142.3857, -113.6069, -11.7910, 139.1833, 152.7098, 190.2991, 185.1957, -45.3875, 248.0296, 182.6688, 88.8755, 214.4643, 190.5678, 102.4739, 80.3691, 0.5875, -198.7756, -74.9356, -117.6948, -65.6100, 40.3633, 74.6226, 186.1648, 381.8571, 110.4414, 89.0941, 137.9085, 156.0651, 270.4297, 136.9997, 96.7223, -88.7486, -205.4632, -32.5155, 32.4312, -205.6694, -153.2214, 37.6450, 85.9107, -3.7831, 74.7554, 126.5815, 159.1586, -19.8933, 81.8806, 310.4290, 228.4172, 252.4693, -31.2684, -62.9530, 8.7157, -10.6136, 57.5727, -19.6370, 25.3397, -13.7909, 6.6773, -39.6067, -57.5496, 99.4232, 204.6920, 216.8922, 189.3473, 135.5090, -21.7097, 104.1268, 101.2531, 148.1480, -3.5323, -95.7586, 128.4049, -10.9430, -110.0682, -78.5038, -66.8904, -222.1310, -15.6747, -21.6863, 116.4425, 319.6457, 233.5941, 89.4486, 235.1445, 167.0428, 245.7901, -26.6830, -52.4425, -204.0325, -20.1279, 134.6238, 47.4337, -54.1049, -325.7247, -208.4492, -40.0934, -63.0374, 40.1010, -69.0964, 163.1230, 108.1724, 175.3995, -11.9368, 103.8019, 209.1036, 120.3514, 20.6692, -10.3036, 90.8382, -15.4495, -27.9360, -44.9416, -159.6922, -61.5420, -263.0338, 101.3112, 143.6524, 55.2063, 73.1170, 236.4737, 261.0068, 4.9542, 196.7222, 235.6913, 148.8757, 187.3009, -60.5952, -27.3096, -9.7035, -66.2132, 11.5192, -36.5126, 7.0222, 78.3911, 129.6773, 2.0386, 188.1640, -68.9615, 87.7868, 311.2155, 175.1420, 164.0808, 154.0194, 120.9947, 65.6866, -35.2961, -225.4056, -46.0960, -135.6720, -242.0772, -206.4037, -62.6808, 21.1389, 9.7415, 97.7905, 4.9165, -116.9663, 84.8932, 179.4275, 140.1541, 142.9142, 220.5956, 108.8786, -10.8176, 29.0902, -164.8863, -283.8176, -454.5352, -227.9726, -120.2319, -81.9417, 219.3423, 178.5171, 305.0380, 314.0889, 280.2647, 265.9385, 135.9701, 210.2778, 25.5317, -249.0574, 151.6382, -88.8462, -150.8793, -61.4238, 168.5808, -29.3067, 23.0886, -273.1383, 86.3529, 55.9074, 161.4766, 259.0551, 285.7078, 166.9959, 268.3087, 280.7943, 199.8479, 18.9355, -22.5024, -31.1617, -94.0315, 28.2916, 8.1242, -275.9820, -15.1220, -23.0359, -27.2240, 10.1078, 110.1960, 116.2925, 37.3720, 117.2465, 60.3729, 279.7546, 271.6898, 184.7965, -29.5694, -189.9855, 46.0628, -284.6475, -95.9809, -128.3105, -41.1132, 190.2040, 35.8866, -6.8359, -90.4739, 234.4215, 257.7885, 210.0560, 185.8374, 11.3853, 145.2748, 197.9807, 79.4020, -16.8556, 133.3235, -176.9518, -139.7429, 30.6194, -149.5712, 189.7218, 86.1094, 78.4439, 15.0234, 23.7140, 284.7874, 117.4376, 94.2648, 355.0135, 70.7756, 136.4097, 73.1279, 100.7412, 49.3568, -228.0449, -101.6197, 35.2195, -11.7054, -407.0041, 30.0243, -11.0935, 145.3110, 85.4297, 157.7165, 166.2199, 340.3784, 227.6298, 347.2660, 94.8228, 133.1098, -47.9421, -70.4541, 52.6744, -99.6285, 53.2071, -167.4233, 2.4220, 122.1443, 23.5211, 203.6342, 105.3230, 167.1768, 106.4586, 87.0334, 181.3073, -66.8421, 192.7382, 91.1583, 63.1073, -366.5447, -207.8926, 62.6304, 81.0882, 33.3065, 174.8351, 154.3837, -38.3506, 56.7034, 27.9668, -20.2311, 58.6507, 66.9344, 234.4440, 266.7708, 227.1159, 124.9572, 87.9951, 132.0331, -89.8895, -82.2391, -4.1144, -27.4725, 128.4141, -22.8619, 151.5487, 139.7842, -53.9783, 138.6293, -58.5596, -77.1421, 47.5015, 104.1882, 100.1463, 167.0159, 215.3008, 168.4910, 98.4097, 11.8965, 13.9682, -17.6100, -20.0889, 77.8626, 84.1791, 59.0953, 210.6732, 4.6617, -26.7878, 66.6817, 129.2994, -50.2264, 70.0385, 90.7852, -118.2261, 54.7315, 2.8437, 103.2410, -30.9917, -23.0856, -6.5828, 10.2997, -8.8420, -218.0626, 194.7955, 42.6290, 115.7053, 2.6403, 253.2278, 166.8814, 6.7618, 11.9955, 10.1750, -90.5545, -85.2868, 128.8059, -69.4191, -116.4348, 186.6006, 126.2871, 38.2242, 263.3911, -135.3905, 62.0835, 159.5840, 13.8909, 127.0455, 82.5040, 8.6403, -133.6924, 80.9575, 152.4312, 128.7140, 26.5720, 114.1174, -195.9101, -160.6119, 71.6670, -192.4444, -112.6696, 201.2598, 153.7886, 135.7793, 113.5774, 174.3283, 118.9185, 91.8013, 118.2863, 78.7210, 52.3530, -52.3985, 26.9917, 75.3040, 41.4498, -22.1823, 126.9623, 211.1427, -94.4107, 20.5242, 130.3401, 123.3512, 61.7974, 15.8105, 96.1131, 98.2501, 88.1441, 2.8220, 269.3537, -93.5528, -130.1510, 338.4854, 68.4744, -134.7975, -48.6130, 47.5692, -49.5836, -21.7983, 39.8618, 40.1231, 28.9229, 197.7214, 208.7893, 318.2140, 40.5068, -432.5159, 121.8774, -28.1986, -116.2692, 126.1644, 106.3012, -313.0871, 103.9927, 105.1409, 34.7044, 79.5384, -392.8566, -859.5023, 848.9410, -7.5184, 281.4053, -50.9261, 261.7060, 78.7047, -272.5192, 1021.9954, 513.0021, -358.2669, 255.7143, 80.1611, -454.7350, 856.9226, 570.8085, -173.3269, -15.7260, -8.1741, 126.0346, -138.5201, 156.8936, 558.2916, -334.0358, 269.8414, 332.0496, -9.4234, -368.0312, 161.6786, -166.2357, 346.4521, 517.2386, -202.7122, -88.0989, -216.9291, -31.0239, 10.2048, 491.6268, 264.5648, -268.3686, -42.6326, 116.7361, 100.6134, 345.3075, 64.7371, -314.5260, 213.5001, -217.5975, -272.2699, 12.2532, 127.3276, 317.3645, -86.9028, 184.9965, -370.6536, -38.7510, 578.3087, -353.0112, 83.0921, 246.8762, -261.4520, 88.4618, 200.6202, 20.1619, 483.4876, 649.2910, 462.8118, 41.2036, 107.7401, -41.0891, -56.8575, 88.3975, -204.7521, 377.1028, -91.6230, -287.9168, -270.6733, 169.1768, -184.4609, 407.1980, -32.8786, -343.1597, -276.0383, -603.9590, 277.0688, -141.8340, 383.8777, 20.7790, -372.2959, -547.8881, 21.5385, 42.6120, 17.6977, 310.6867, -388.2564, -630.1894, -17.7147, 408.3271, 355.5534, 293.0159, 394.5593, 165.9444, -698.5503, -175.4947, 293.5366, 289.1929, 470.1828, -29.8628, 289.1234, -625.8773, -29.9197, 470.0533, 383.8549, 364.7629, 226.2534, 557.7197, -427.8472, -99.6540, 414.1069, 392.6592, 415.5016, 326.8064, -436.6323, -192.8187, 412.4814, 457.5456, 550.5166, 30.4278, -558.5258, -812.6537, -2.3066, 302.0320, 431.7067, 431.2735, 168.1744, -638.0233, -135.0218, 663.0154, 562.2292, 418.5283, -9.2832, -628.3847, -290.2317, 688.7889, 316.5431, 121.7213, -133.1742, -116.3093, -179.9561, 391.8664, 502.2522, 295.2221, -146.9780, -323.8500, -215.5717, 534.3645, 268.0734, -182.2095, -451.1250, -342.9679, 29.1241, 900.5476, -122.3033, 194.4617, -263.2437, -553.2925, -254.9083, 630.6352, 368.5865, -79.2201, -237.7014, -378.8422, -102.4370, 327.4257, -65.3397, -253.6086, -219.4341, -109.5008, 142.3381, 113.6842, -4.1719, -499.8676, -396.4576, 30.4204, 66.8421, 140.2718, 149.8569, -402.3498, -233.3130, 165.1321, 489.5298, 197.1258, -5.7985, -297.6096, -138.2629, -119.8253, -36.7683, 453.6640, 154.4054, -132.5335, -352.4157, 45.9226, 146.6687, 529.7363, 318.4601, 114.1136, -151.4683, 16.2919, 274.3330, 323.4341, 247.7847, 97.8262, 210.8891, -236.5375, -285.4914, 137.3161, 309.7126, -44.4111, 148.5431, 7.4277, -82.4675, 101.6618, 245.1873, 209.1197, 156.4347, 201.1798, -205.3711, -75.0829, -43.7484, 158.7887, 173.4571, 176.0768, 27.1578, -145.8453, -222.4274, -145.3787, 178.5598, 96.6631, 117.8614, -139.7470, -188.6024, 17.6352, 164.6958, 138.3647, 146.7328, -45.5155, -227.9686, -270.1709, -116.6248, 146.5040, 113.7563, 23.3236, -110.6361, -334.5773, -150.4820, 93.0250, 149.8184, 234.9640, 50.4202, 12.7832, -283.7963, -32.7726, 181.8021, 72.5528, 297.8747, 81.4686, 85.3076, -241.3209, 72.5810, 133.3780, 255.4027, -5.7158, 147.4593, -117.9087, -188.4237, 107.6945, 0.1725, 162.5800, 115.9006, 260.5787, 120.5328, -87.4489, 179.5587, 63.4271, 148.3833, 155.7271, 23.0259, -1.2896, -194.8028, 5.9731, -13.9924, 92.0485, 112.1720, 253.9281, 89.1493, 39.7953, 130.7270, 59.3593, 109.4630, 124.0793, 168.4365, 54.7242, -116.1085, -242.1875, -109.9474, 116.0801, 286.4980, 137.2533, 130.6045, -40.3734, -267.5993, -190.5531, -96.4721, 172.8532, 296.3770, 6.6468, -42.2744, -158.3455, -3.4608, 475.5543, 172.1287, 92.4420, -96.8034, -143.8538, -385.5552, -102.6221, 150.4753, 38.4336, 303.3816, -33.3299, 17.1631, -216.5489, -131.2942, 442.3832, 180.4010, 25.8630, -7.7930, -98.6930, -109.9303, -11.9802, 433.2684, 138.6502, -133.7642, -10.6288, -8.4167, -87.9099, -258.2360, 263.1253, 91.0702, 127.2881, 113.1789, -52.1970, -153.2777, -61.3535, 378.6497, 68.6149, 345.4905, 176.5631, 28.5331, -228.6388, -495.5952, -152.8241, 10.9607, -103.4166, 256.8004, -83.5477, -225.6919, -217.5334, 414.8362, 220.0782, 200.5235, 121.2829, -294.3371, -161.8298, -467.0071, 218.8494, 274.8568, 86.0640, 323.0122, -144.5595, -241.3564, -190.1630, 216.7534, 377.5679, 153.1294, 181.6010, -19.3122, -213.4202, 0.6400, -87.0225, 101.8632, 222.2160, 12.7499, 91.3200, -46.2616, -248.6117, 223.7196, 108.6442, -48.3699, 74.2728, -10.8952, -40.5442, -51.5829, 139.9990, 72.3984, -102.8235, 151.4186, 221.9899, -71.3659, -103.5506, -46.6935, 159.4012, -257.4942, 170.1752, 145.8232, 52.7827, -35.6436, 109.7627, 166.5744, 38.5971, 144.1694, 142.1368, 150.1395, 74.2694, -30.3310, -159.6363, 62.1120, 221.2967, 167.5541, 4.0721, 35.1026, -142.9687, -92.4015, 2.8530, 174.1346, 235.5856, 227.4606, -3.3309, -88.9622, -210.8647, -148.5299, 389.4347, 180.7957, 121.0010, 172.4754, 46.7395, -61.4741, -129.2730, -438.9959, -52.7705, -124.6577, 40.2247, -347.0593, -566.9115, -633.5044, 218.7958, 402.0214, 455.9258, -170.0066, -375.3985, -652.7766, 534.2909, 827.6288, 221.5820, 128.8531, -39.1167, -114.2715, -37.3244, -129.1735, -142.8696, 100.4661, 510.9595, 609.1795, 473.3759, -222.4564, -580.6640, 89.6704, 653.7973, 590.7477, 173.7528, -658.3790, -311.0025, 455.1520, 64.9299, -10.7542, -491.0663, -513.9588, -591.1392, -77.5136, 583.7966, -117.9908, 83.2780, 240.2606, 131.4541, -142.4207, -395.8609, -114.8197, 454.1219, 275.2769, 258.3771, -237.2898, -668.6396, -69.2784, -330.1771, 703.6947, 94.5641, -344.8887, -410.3256, -335.1370, 895.4051, 258.7011, -91.7037, 256.5687, -161.7129, -197.3498, -192.2008, -69.0622, 341.0593, 625.6137, 694.6117, 409.2617, -94.2310, -15.1508, 39.2101, 427.4738, 731.7695, -103.7709, -177.0112, -467.7198, 331.3183, 271.0333, 74.0575, 173.9896, -194.8974, -390.8844, -321.4563, -327.9061, -47.4525, 223.5900, 455.9542, 221.5099, -259.2512, -400.4021, -51.8402, 264.8279, 773.1299, 504.3034, 172.9437, -363.8781, -0.2259, 426.4117, 120.8038, 565.1029, 251.6076, 103.7108, -679.6039, -46.7661, 370.9856, 117.1656, 310.9919, 32.5447, -314.8866, -192.3350, 108.0731, 370.0351, 494.5563, 366.0557, 356.1939, -101.7029, -24.6213, -357.2899, -96.2895, 522.6996, 151.8800, 40.5386, -495.9972, -506.4964, -31.1026, 409.5386, 355.9698, 75.8829, -130.6052, -335.2382, -30.4496, 97.8365, 386.9593, 480.8288, 298.2488, -131.1586, -202.0693, -278.2947, -232.7290, 274.4196, 207.7851, -105.0327, -231.2148, -212.8489, -99.3418, 356.2779, 331.3733, 329.8312, 482.3131, 269.3609, 66.1892, 163.4243, -53.6484, 204.6363, 218.4793, -10.5226, -328.8483, -388.6145, -430.8820, -6.6916, 412.1170, 402.6791, 72.5699, 24.9044, 136.9652, -134.8729, 114.2165, 145.6175, 538.2167, 276.4466, 70.4504, -120.7325, -282.0011, -259.4828, 39.1613, 111.1145, -230.3253, -242.1201, -369.3127, -358.4536, -255.9907, 370.0195, 510.0765, -74.6857, 45.1207, -9.9355, -12.2471, 266.1170, 316.2896, -5.7631, -100.1578, -296.3546, -532.7704, -157.4558, 40.7279, 244.4061, -13.8046, -15.3863, 11.1656, -151.0688, 100.7864, 436.2173, 488.8429, 80.1120, 69.3730, -156.1886, -219.0432, 17.4807, -23.5554, -46.7308, -160.4949, -143.8178, -218.6033, -213.8154, -333.6501, 183.5094, 373.5299, 162.4532, 427.9205, 37.4584, -41.1309, -12.7055, 211.4222, 63.7738, 16.3288, -88.2820, -305.0261, -311.7865, -293.4448, -81.2541, 217.4876, 239.1086, 132.7785, -69.0611, -93.4650, 83.8376, 179.3818, 616.5009, 305.8501, 74.8922, -189.2610, -337.7155, 98.0537, 110.3485, 39.4429, 114.9597, -404.2281, -271.7370, -66.6264, 177.0931, 396.7773, 536.6047, 557.8629, 219.5219, 15.8970, 197.4311, 297.3062, 401.0570, 272.7869, -137.8157, -170.3788, -300.7033, -288.4240, 73.3481, 407.4116, 490.1157, -220.2592, -147.6200, -137.4741, 244.5344, 478.3448, 632.4193, 422.1267, -41.3182, -349.6729, -19.0158, 101.4191, 126.8914, 232.4045, 88.3375, -350.8874, -120.1890, -227.8718, -76.0019, 384.2331, 355.1311, -757.7970, -108.2984, 318.7107, -660.0330, 586.1799, 261.8952, 155.7322, 6.4919, -560.5225, 474.2349, -520.6046, -263.4657, 359.8716, 110.7552, -439.2510, -390.7692, 946.6156, -63.2015, 367.4281, 664.8172, -172.5245, -162.9776, -730.0482, -38.6026, 679.3852, -335.2526, 589.1303, 340.3236, -395.2855, -700.8677, -11.3694, 489.8178, -317.0539, 535.2267, -440.5989, -269.0409, -237.7360, 198.0293, 655.0880, -76.3669, -14.2903, 225.0300, -511.5382, -466.9496, -414.9632, 92.3469, 879.4305, 121.2868, -48.6707, -501.3238, -178.3331, -234.7582, 372.1276, -230.9883, 173.4514, 265.2124, -69.0550, -431.2441, 25.4434, 59.6586, 819.9320, -227.9680, 30.9943, -154.0342, -284.7946, -225.4188, -120.3848, 897.7018, -211.1831, 74.9318, -169.1333, -200.3895, 398.6117, -173.1031, 242.9603, 778.5952, -378.1751, -128.0366, -215.2032, -28.5142, 8.4454, -90.9715, 721.9891, -276.4136, -220.0074, -60.3791, -185.6788, 354.3017, -426.3024, 113.7759, 776.8338, -79.7953, -184.2208, 154.1872, 300.9449, -399.2756, -22.8012, 599.4503, -262.4689, -463.0202, 167.7512, 195.4506, -176.5659, -638.7834, -7.3405, 26.3168, -121.8957, 499.5648, -156.7153, 464.2612, -525.0536, -72.8900, 46.5729, 11.2177, 379.1621, -303.9627, 234.0750, -191.0627, 422.1916, 70.5903, 106.6127, 32.0388, 472.2539, -235.9237, 228.8050, -619.4576, 731.8944, 358.0328, 151.1605, 340.4620, -552.4439, 143.3419, -656.2229, 451.8670, 232.3183, -64.0831, -194.1501, 113.6278, 148.0341, -94.9135, -321.1109, 720.3262, 720.0924, 35.6518, 202.5463, 234.9027, -41.1697, -261.1347, 389.8523, 611.2910, -381.8140, -154.0562, -276.9495, -9.9791, -47.7337, -457.3684, 479.6894, -148.1929, -157.9097, 44.5052, 145.0144, 265.3068, -242.4212, 182.4762, 342.1233, 57.7228, -246.9845, 65.1431, 282.8152, 40.4674, -431.2869, 200.3394, 87.1691, -166.6247, -126.7532, 49.9392, 274.7249, 52.9689, 438.9514, 148.5536, 170.9945, 34.4185, 124.7695, 110.3265, -186.5423, -131.0890, -99.0385, 27.0666, -129.5799, -130.4584, 158.5028, 316.9574, -56.8539, 289.0063, 413.8272, 276.9690, 221.8905, 170.5313, 224.7911, -63.4200, -205.0314, -55.6850, -45.4222, 51.7123, -109.5214, -298.1125, 237.8411, -248.0507, -130.4535, 273.8135, 300.8740, 128.6436, 75.1837, 403.9700, 64.9008, -263.3667, 183.1138, 169.9571, 167.8441, -19.5562, -233.6238, -283.6907, -27.3381, 33.8118, 38.4138, 108.9636, 27.0155, -5.4571, 204.2812, 156.3095, 177.8839, 365.0854, -60.4553, 137.5818, 91.7338, -50.6411, -56.1957, 152.1712, 10.2454, -73.3990, -128.9045, 11.4385, -204.1438, -178.5765, 251.5283, 84.5457, 275.2295, 297.4972, 321.0972, 292.6491, 128.2943, 170.4869, 411.0831, 158.0746, 59.7774, -90.6516, -62.6524, -134.6853, -244.4251, 129.9751, 37.5548, 97.5328, 38.8691, 220.8129, 161.3913, 302.0350, 208.9279, 242.0022, 346.8763, 53.4553, -55.3519, -91.6662, -0.8673, -91.1690, -10.9419, -83.9468, 78.1963, -142.8830, -21.2476, 234.2305, 199.8383, 131.3604, 24.4090, 82.9764, 60.6691, 88.5654, 78.5883, 82.4595, 34.8088, -154.1222, -179.0914, -83.7096, -114.8624, 7.5583, 80.0052, 112.9702, 85.6664, 119.4412, 115.3920, 161.8309, 123.7566, 161.1668, 161.1846, 336.3552, 191.1281, 86.2952, -132.3834, 1.1000, -174.8498, -31.0275, 171.2413, -116.2117, -13.4535, -219.2436, 167.7913, 40.6331, 203.8938, 125.8609, 358.1855, 41.0842, 18.7814, 47.5777, 54.8061, 164.4992, 115.5582, 90.9193, -55.0182, -204.8376, -83.1787, -64.4334, 172.2781, -232.8424, -269.4980, -37.6285, -19.4467, 95.0278, 133.7178, 253.6720, 112.3204, 168.2270, 98.2113, -107.8485, 168.0720, 127.8902, 129.2534, -36.9357, 11.8532, -225.3587, -191.2744, 201.3329, 12.3903, 182.1500, 192.0139, 228.6635, 266.0335, 23.1080, 14.1863, 143.4055, 96.6072, 103.7777, 93.2973, -71.2527, -2.7998, -153.9439, -96.3610, 15.5539, 0.8051, -63.3315, 111.9519, 158.0824, -54.4741, 232.5683, 234.2801, 223.3371, -17.3019, 216.1941, 134.8078, 7.6949, -54.8282, -63.6300, -148.9993, -10.6535, -166.2623, -107.5046, 74.0002, 127.2573, 138.9762, 47.5379, 160.6348, -109.3561, 196.0952, 165.3003, 264.8850, 182.4213, 228.6772, 338.1506, 104.6345, -97.8055, -489.1400, -153.8180, -14.7219, -156.9031, 136.9478, 239.0502, 10.2017, 75.3157, 167.5712, 183.4109, 219.1609, 136.9001, 124.1082, -179.2789, 58.1178, 37.0682, 120.2975, 182.9931, 110.9289, -189.4694, -8.9981, 108.8501, -114.7782, 72.8857, 282.8105, 91.7538, 54.4809, 245.0075, 28.9462, 158.0186, -82.3083, -92.9535, 3.8316, 34.5508, 19.7914, -135.0595, 110.7760, 165.9538, 137.6292, -33.6630, 65.7970, 140.9611, 105.8276, 64.9913, -97.2696, 190.0871, -100.5120, -185.4652, 177.2411, 100.9638, 83.0082, 77.2612, 138.5107, 40.4122, 189.0370, -163.3275, -267.1924, -5.8529, -87.2219, 11.2168, -57.2687, 169.1528, -74.4962, -15.5406, -46.2652, -9.0603, 215.9589, 25.9710, -43.1042, 93.2781, 22.4679, -74.0876, -89.0576, 86.9279, -21.2364, 113.4954, -120.3071, 62.8078, -10.8866, -100.7056, -19.5469, -163.4792, 1.1831, 210.7769, 146.0958, 103.0461, 125.2048, -89.1385, 4.4422, 1.4354, -40.4847, -6.7528, -12.9685, 11.7200, 37.7039, 46.3730, -12.9874, 30.6360, -77.0582, -81.1103, 50.8458, -12.0774, -47.7789, 97.4354, -23.6667, 223.2506, 65.9481, 34.1970, 210.6742, -85.8559, 57.9993, -88.1327, -5.7346, 95.2420, -106.3875, 19.5151, -14.3740, -26.9709, 39.0752, 210.7114, -45.4850, -1.7302, 263.4399, 244.6251, 222.1004, -104.3527, -49.7442, 192.8828, 90.2806, 9.4145, 194.0381, 115.3685, -11.2457, 141.5417, -222.2438, -87.0636, 92.8063, 125.9417, 31.3067, -43.3905, 328.2408, 197.0209, 105.4536, 188.7286, 376.1131, 211.9026, 91.3603, 68.4937, 115.6834, 52.5176, 51.3781, 127.4330, 211.7000, 32.2858, -29.2221, -9.2661, -43.9633, 66.0215, 135.5077, 90.1145, 182.9098, 104.7198, 65.1317, -22.6523, 70.0226, -219.6047, -9.2904, 63.1567, -69.4488, -74.3424, -81.6233, 247.6212, -41.3729, -52.3175, 234.6851, -24.7489, 242.4943, 265.2906, 209.1336, 120.3777, 110.1246, 120.6190, 71.3160, -22.1874, -8.1628, -222.1882, -216.3215, 25.5429, 60.1460, 151.5773, 156.8396, 266.0755, 278.4825, -7.9164, 273.5901, 8.2677, -35.4113, 90.7481, -130.5313, 5.4297, -43.6593, -16.6142, -259.5881, -165.5069, 79.7537, -194.1477, 124.5440, 221.7133, 301.1388, 476.4342, 266.6968, 228.9616, 78.8283, 69.9034, 27.7953, -151.7546, 89.7345, 153.8024, -32.3952, -173.9060, -124.3951, -7.2720, 1.4355, -44.4882, -40.3421, 77.1862, 71.5389, 67.7644, -69.5450, 247.2514, 177.2454, 125.8990, 292.6210, 130.9199, 49.8708, -370.5245, -95.8539, -101.7338, -78.5832, -207.5041, 0.7569, 16.3687, -210.4080, 148.4233, 168.5685, 96.2852, 177.7597, 432.0124, 233.7126, 259.7703, 121.3456, -26.3149, 55.6475, -79.2311, -45.3307, -216.6526, -107.8952, -42.8800, -209.1040, -151.3432, -13.3855, 92.8699, 100.7736, 60.1054, 254.0886, 242.0202, 311.7877, -28.6013, 139.0529, 147.7504, 117.2919, 29.7629, 60.4767, 26.0288, -39.0701, -27.9226, -185.7220, -198.2111, -75.2479, 194.0526, 205.8560, 200.5070, 375.7483, 448.8907, 416.8026, 47.3060, 201.5159, -115.0412, -83.8418, 54.3909, -301.4546, -371.0443, -84.6353, 38.3433, -43.2987, -88.8498, 68.7645, 45.4906, 11.1306, 253.1450, 239.1987, 86.6465, 56.9179, 221.4929, 216.3724, 59.9334, -84.4640, -252.0562, -267.4133, -176.2710, -261.8736, -371.4934, -206.2687, -92.9225, 68.5123, 151.5145, 87.2763, 252.1625, 390.7015, 271.5020, 282.1263, 305.8905, 174.6327, 247.7130, 12.9775, 14.4804, -132.8056, -260.0377, -111.9433, -233.8472, -24.7243, 56.5446, 49.5123, 2.5944, 399.8340, 333.0026, 404.7644, 404.8069, 240.9324, 364.1482, 335.5286, 63.2781, -10.2043, -45.7309, -24.5902, -292.4311, -238.7645, -159.1494, -161.9022, -45.5454, 93.5895, 5.9167, 240.4482, 243.9676, 176.4915, 470.2534, 414.2475, 228.5877, 152.4041, 164.0395, -160.2338, -36.2624, -100.0684, -135.9555, -177.3981, -230.7565, -169.8202, -124.5493, 9.9942, 56.2805, -45.7747, 112.1426, 294.7343, 287.1606, -98.4562, 83.3073, 28.8082, -183.0762, -325.1701, -467.0753, -266.9044, -195.4564, 47.4775, 87.2900, 123.3368, 232.7018, 301.9666, 349.1215, 225.4356, 277.5261, 366.0346, 491.3321, 493.3475, 274.0771, 135.0787, 68.2622, -64.2621, -147.2114, -246.7778, -58.6343, -123.9344, -44.1322, -25.3115, -223.5875, 278.3949, 292.4807, 191.2602, 279.9717, 137.8633, 186.7143, 334.7093, 48.5757, 90.9844, -33.5513, -183.1946, -287.8277, -201.4847, -283.6870, -516.0996, -338.1356, 10.1616, 31.9898, 174.9650, 148.4188, 289.4741, 261.4414, 379.6063, 288.0028, 154.1273, 239.5524, -125.4808, 37.5650, -27.2590, -253.1931, -348.3428, -368.4310, -429.1796, -36.3004, 0.8706, 248.4518, 181.8032, 268.7897, 137.7689, 451.8229, 266.2349, 105.2575, 264.4521, -36.3731, 155.6161, 26.2516, -119.0677, -310.5591, -206.5296, -175.3477, -267.7129, -39.8671, -22.0337, 98.4895, 222.5421, 225.0746, 349.3420, 200.0598, 240.6469, 116.0866, 154.0568, 175.2522, 104.3847, -20.0928, 143.9091, 103.3917, -179.8215, 34.7972, -24.5964, 23.9019, -145.7423, 90.6992, 222.2808, 232.1092, 176.1374, 148.1926, 342.9851, 70.9478, 75.6145, 217.3142, 44.5896, -197.4927, -176.5177, -187.0957, -96.7757, -56.5797, -47.5165, -47.7105, 124.8367, 199.0886, 29.8191, 124.4961, 366.9366, 258.8575, 57.3850, 296.2000, 276.2489, 109.0434, 181.9466, 151.5052, -61.2970, -206.7784, -135.9287, -19.0380, 87.8392, 92.2332, 176.1108, 144.1368, 208.8372, 376.9556, 462.3079, 121.0735, 251.0123, -41.7443, -5.3093, -13.6104, -142.3796, -194.9089, -78.3798, 37.0557, -28.3194, -18.4533, 113.0896, 63.3176, 12.5438, 171.3060, 180.4093, 135.2094, 202.5431, -39.2360, 78.4240, 212.3317, -36.3777, 94.0166, 28.6782, -27.6819, -72.9359, -164.4485, 107.1331, -360.3724, -155.8750, 38.8923, -14.7907, 93.6311, -49.4427, 195.0507, 136.0314, -2.1040, 150.9021, 323.3362, 378.4676, 172.3812, 15.8958, -38.4707, -10.0375, -173.5007, -260.7221, -72.7215, 39.2250, -78.2296, 100.9818, 116.9105, 127.3517, 231.0637, 207.0143, 307.4187, 202.2287, 351.4096, 202.7332, -104.3734, 93.2425, 53.9816, -59.1757, -25.4611, -165.8785, -314.4284, -199.4846, -40.7356, -12.4693, -11.7298, 39.9232, 242.4912, 113.9767, 143.2959, 261.5669, 199.4264, 123.2215, 224.9698, 121.1720, -49.7616, -189.5866, -167.3123, 1.4661, -192.3349, -94.9475, -160.7573, -271.9334, -81.6324, -42.7419, 188.3975, 240.2874, 15.8536, 213.4034, 217.7974, 134.1265, -178.5131, -130.7765, -85.0314, 61.8851, -176.3128, 8.9722, -14.3317, 120.6904, 64.7144, 20.5050, -7.0255, -28.2674, 122.4064, 167.0231, 141.3291, 210.4406, 209.1432, 186.7644, -53.8849, 37.2541, 43.3962, 42.7506, -112.7290, -94.0714, -27.5997, -112.8724, 34.0892, 125.1637, 38.2379, 172.6141, -72.5186, 30.4292, 175.0357, 129.3448, 276.5024, 151.6695, 126.8999, 109.1042, 253.2293, -14.4969, -41.6995, 43.6559, -93.3268, -47.0102, -148.3145, 33.1781, 101.9466, 27.6491, -23.0116, 171.5104, 109.5803, 89.1835, 220.5692, 33.3064, 110.6393, -57.6375, -81.9796, -16.3814, 25.5435, 51.1204, -26.3715, -30.1366, -50.6585, -42.0800, 53.8396, 285.7816, 97.3082, 42.1063, 193.3532, 273.7451, -29.9312, 252.6355, 101.5132, -85.5192, -28.1645, -181.2682, 106.3503, -20.9774, 192.5229, 50.6862, 14.1333, -29.2301, -163.4016, 66.0173, 252.8694, 52.0363, 41.2448, 208.7483, 175.5116, 200.8521, 213.0154, 62.5627, 118.1903, 67.3200, -79.5885, -158.4148, -176.2838, -67.5101, 11.8085, 148.2638, -17.9825, -30.0670, 159.4990, -33.7578, 14.6296, 163.6697, 111.9086, 135.2631, 156.9805, -1.1107, 78.0430, -218.1392, -123.3486, -135.0563, -104.9488, 96.3648, -9.8758, 114.5933, 325.5607, -91.9174, 40.2392, 273.0188, -16.0752, 133.3097, -7.6530, 179.5136, 35.2363, -1.4393, 79.1874, -36.7579, -88.7343, -130.1902, -158.6332, -251.8058, 50.7898, -158.3444, -195.0592, 147.9904, 257.6556, 203.0190, 216.3908, 97.8668, 250.8421, 133.7209, -213.2974, 85.6795, 54.4344, -162.5035, -52.6428, 16.3448, -180.8622, 92.9527, -128.9298, -160.6619, -92.2781, 57.0476, 251.2707, 208.4843, 215.0587, 169.4898, 362.5846, -15.8894, -6.0057, 75.2140, -83.5557, -124.9098, -41.1047, 15.3298, -322.5079, 216.1302, -97.9780, 70.8587, 41.7845, 7.7017, 65.9946, 189.8104
};

// configuration
#define INSIZE EI_CLASSIFIER_DSP_INPUT_FRAME_SIZE 

const struct analog_microphone_config config = {
    // GPIO to use for input, must be ADC compatible (GPIO 26 - 28)
    .gpio = 26,

    // bias voltage of microphone in volts
    .bias_voltage = 1.25,

    // sample rate in Hz
    .sample_rate = 16000,

    // number of samples to buffer
    .sample_buffer_size = 4000,
};

// variables
int16_t sample_buffer[INSIZE];
volatile int samples_read = 0;

float features[INSIZE];

const int minutes = .3;
const int threshold = 10;
const float thresh = 0.9;

int count_label_on = 0;


void on_analog_samples_ready() {
    // callback from library when all the samples in the library
    // internal sample buffer are ready for reading 
    samples_read = analog_microphone_read(sample_buffer, INSIZE);
}


int raw_feature_get_data(size_t offset, size_t length, float * out_ptr) {
    memcpy(out_ptr, features + offset, length * sizeof(float));
    return 0;
}

void wait_for_usb() {
    while (!tud_cdc_connected()) {
        printf(".");
        sleep_ms(500);
    }
    printf("usb host detected\n");
}   

int main(void) {
    // initialize stdio and wait for USB CDC connect
    stdio_init_all();

    wait_for_usb();

    printf("connected\n");

        printf("size of features/floats: %d\n", sizeof(features) / sizeof(float));
        printf("EI_CLASSIFIER_DSP_INPUT_FRAME_SIZE:%d\n", EI_CLASSIFIER_DSP_INPUT_FRAME_SIZE);
        printf("EI_CLASSIFIER_RAW_SAMPLES_PER_FRAME:%d\n", EI_CLASSIFIER_RAW_SAMPLES_PER_FRAME);
        printf("size of features returned: %d\n", sizeof(features));
        printf("total_length: %d\n", sizeof(features) / sizeof(features[0]));
        printf("\n");



    ei_impulse_result_t result = {
        nullptr
    };

    ei_printf("Edge Impulse standalone inferencing (Raspberry Pi Pico)\n");

    // initialize the analog microphone
    if (analog_microphone_init( & config) < 0) {
        ei_printf("analog microphone initialization failed!\n");
        while (1) {
            tight_loop_contents();
        }
    }

    // set callback that is called when all the samples in the library
    // internal sample buffer are ready for reading
    analog_microphone_set_samples_ready_handler(on_analog_samples_ready);

    // start capturing data from the analog microphone
    if (analog_microphone_start() < 0) {
        ei_printf("Analog microphone start failed!\n");
        while (1) {
            tight_loop_contents();
        }
    }

    /*
    if (sizeof(features) / sizeof(float) != EI_CLASSIFIER_DSP_INPUT_FRAME_SIZE)
    {
      ei_printf("The size of your 'features' array is not correct. Expected %d items, but had %u\n",
                EI_CLASSIFIER_DSP_INPUT_FRAME_SIZE, sizeof(features) / sizeof(float));
      return 1;
    }
    */
    
    while (1) {


        // wait for new samples
        while (samples_read == 0) {
            tight_loop_contents();
        }


        ei_printf("\nStarting inferencing in 3 seconds...\n");
        sleep_ms(3000);

        // store and clear the samples read from the callback
        int sample_count = samples_read;
        samples_read = 0;
        

        // loop through any new collected samples
        
        for (int i = 0; i < sample_count; i++) { 
            features[i] = (float)sample_buffer[i];
            
        }
        
        /*
        printf("sample_count returned: %d\n", sample_count);
        printf("size of features/floats: %d\n", sizeof(features) / sizeof(float));
        printf("EI_CLASSIFIER_DSP_INPUT_FRAME_SIZE:%d\n", EI_CLASSIFIER_DSP_INPUT_FRAME_SIZE);
        printf("EI_CLASSIFIER_RAW_SAMPLES_PER_FRAME:%d\n", EI_CLASSIFIER_RAW_SAMPLES_PER_FRAME);
        printf("size of features returned: %d\n", sizeof(features));
        printf("total_length: %d\n", sizeof(features) / sizeof(features[0]));
        printf("\n");
        */

        // the features are stored into flash, and we don't want to load everything into RAM
        signal_t features_signal;
        features_signal.total_length = sizeof(features) / sizeof(features[0]);
        features_signal.get_data = &raw_feature_get_data;


        // invoke the impulse
        EI_IMPULSE_ERROR res = run_classifier(&features_signal, &result, false);

        //ei_printf("run_classifier returned: %d\n", res);

        if (res != 0)
            return 1;

        ei_printf("Predictions (DSP: %d ms., Classification: %d ms., Anomaly: %d ms.): \n",
            result.timing.dsp, result.timing.classification, result.timing.anomaly);

        // print the predictions
        ei_printf("[");
        for (size_t ix = 0; ix < EI_CLASSIFIER_LABEL_COUNT; ix++) {
            ei_printf("%s: %.5f", result.classification[ix].label, result.classification[ix].value);

           
            #if EI_CLASSIFIER_HAS_ANOMALY == 1
            ei_printf(", ");
            #else
            if (ix != EI_CLASSIFIER_LABEL_COUNT - 1) {
                ei_printf(", ");
            }
            #endif
        }
        #if EI_CLASSIFIER_HAS_ANOMALY == 1
        printf("%.3f", result.anomaly);
        #endif
        printf("]\n");

    }

    return 0;
}
